{% extends 'base_club_dashboard.html' %}
{% load custom_filters %}
{% block content %}
<div class="bg-indigo-50 min-h-screen xl:pr-[20%]">
  <section class="container mx-auto px-4 pt-8">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold text-indigo-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª ğŸ’¼</h1>
      <a
              href="{% url 'addServices' %}"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 flex items-center"
      >
        <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
      </a>
    </div>

    <!-- Stats Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-6 text-center">
        <div class="text-gray-500 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>
        <div class="text-blue-600 text-3xl font-bold">{{ services|length }}</div>
      </div>

      <div class="bg-white rounded-lg shadow p-6 text-center">
        <div class="text-gray-500 mb-2">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</div>
        <div class="text-blue-600 text-3xl font-bold">
          {% if avg_price %}
          {{ avg_price }} Ø±.Ø³
          {% else %}
          0 Ø±.Ø³
          {% endif %}
        </div>
      </div>

      <div class="bg-white rounded-lg shadow p-6 text-center">
        <div class="text-gray-500 mb-2">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯Ø©</div>
        <div class="text-blue-600 text-3xl font-bold">
          {% if avg_duration_hours %}
          Ø³Ø§Ø¹Ø© {{ avg_duration_hours }} {{ avg_duration_minutes }} Ø¯Ù‚ÙŠÙ‚Ø©
          {% else %}
          0 Ø¯Ù‚ÙŠÙ‚Ø©
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Search and Sort Controls -->
    <div class="flex flex-col md:flex-row gap-4 mb-6">
      <div class="md:w-1/4">
        <div class="relative">
          <select id="sort-services" class="w-full p-2 border border-gray-300 rounded-md appearance-none pr-8">
            <option value="name">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…</option>
            <option value="price">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</option>
            <option value="duration">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯Ø©</option>
          </select>
          <div class="absolute inset-y-0 left-0 flex items-center pl-2 pointer-events-none">
            <i class="fas fa-chevron-down text-gray-400"></i>
          </div>
        </div>
      </div>

      <div class="md:w-3/4">
        <input
                type="text"
                id="search-services"
                placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®Ø¯Ù…Ø©..."
                class="w-full p-2 border border-gray-300 rounded-md"
        >
      </div>
    </div>

    <!-- Services Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="services-container">
      {% for service in services %}
      <div class="bg-white rounded-lg shadow overflow-hidden service-card mb-8">
        <div class="p-4 text-center">
          {% if service.image %}
          <div class="mb-3">
            <img src="{{ service.image.url }}" alt="{{ service.title }}" class="h-32 w-full mx-auto object-cover rounded">
          </div>
          {% endif %}
          <h3 class="text-blue-600 text-xl font-bold mb-2">{{ service.title }}</h3>
          <p class="text-gray-600 mb-4">{{ service.desc }}</p>
          <div class="flex justify-center items-center gap-2 mb-2">
            <i class="far fa-clock text-gray-500"></i>
            <span>
              {% if service.duration >= 60 %}
                Ø³Ø§Ø¹Ø© {{ service.duration|divisibleby:60 }} {{ service.duration|modulo:60 }} Ø¯Ù‚ÙŠÙ‚Ø©
              {% else %}
                {{ service.duration }} Ø¯Ù‚ÙŠÙ‚Ø©
              {% endif %}
            </span>
          </div>
          <div class="flex justify-center items-center gap-2 mb-4">
            <i class="fas fa-coins text-yellow-500"></i>
            {% if service.discounted_price %}
            <span class="line-through text-gray-500">{{ service.price }} Ø±.Ø³</span>
            <span class="text-blue-600 font-bold">{{ service.discounted_price }} Ø±.Ø³</span>
            {% else %}
            <span>{{ service.price }} Ø±.Ø³</span>
            {% endif %}
          </div>

          <div class="mt-2">
            {% if service.is_enabled %}
            <span class="px-2 py-1 bg-green-200 text-green-800 rounded-full text-sm">Ù…ØªØ§Ø­</span>
            {% else %}
            <span class="px-2 py-1 bg-red-200 text-red-800 rounded-full text-sm">ØºÙŠØ± Ù…ØªØ§Ø­</span>
            {% endif %}
          </div>
        </div>
        <div class="flex">
          <a href="{% url 'editServices' service.id %}" class="bg-blue-600 hover:bg-blue-700 text-white w-1/2 py-2 text-center">ØªØ¹Ø¯ÙŠÙ„</a>
          <a href="{% url 'DeleteServices' service.id %}" class="bg-purple-600 hover:bg-purple-700 text-white w-1/2 py-2 text-center delete-service" data-id="{{ service.id }}">Ø­Ø°Ù</a>
        </div>
      </div>
      {% empty %}
      <div class="col-span-full text-center p-8 bg-white rounded-lg shadow">
        <p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
      </div>
      {% endfor %}
    </div>
  </section>
</div>

<script>
  // Search functionality
  document.getElementById('search-services').addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const serviceCards = document.querySelectorAll('.service-card');

    serviceCards.forEach(card => {
      const title = card.querySelector('h3').textContent.toLowerCase();
      const description = card.querySelector('p').textContent.toLowerCase();

      if (title.includes(searchTerm) || description.includes(searchTerm)) {
        card.style.display = '';
      } else {
        card.style.display = 'none';
      }
    });
  });

  // Sort functionality
  document.getElementById('sort-services').addEventListener('change', function() {
    const sortBy = this.value;
    const container = document.getElementById('services-container');
    const serviceCards = Array.from(document.querySelectorAll('.service-card'));

    serviceCards.sort((a, b) => {
      if (sortBy === 'name') {
        const nameA = a.querySelector('h3').textContent.toLowerCase();
        const nameB = b.querySelector('h3').textContent.toLowerCase();
        return nameA.localeCompare(nameB);
      } else if (sortBy === 'price') {
        const priceA = getPriceValue(a);
        const priceB = getPriceValue(b);
        return priceA - priceB;
      } else if (sortBy === 'duration') {
        const durationA = getDurationValue(a);
        const durationB = getDurationValue(b);
        return durationA - durationB;
      }
      return 0;
    });

    // Remove all current cards
    serviceCards.forEach(card => card.remove());

    // Add sorted cards
    serviceCards.forEach(card => container.appendChild(card));
  });

  // Helper function to get the price value for sorting
  function getPriceValue(card) {
    const discountedPrice = card.querySelector('.text-blue-600.font-bold');
    if (discountedPrice) {
      return parseFloat(discountedPrice.textContent.replace(/[^\d.-]/g, ''));
    }
    return parseFloat(card.querySelector('.fa-coins').nextElementSibling.textContent.replace(/[^\d.-]/g, ''));
  }

  // Helper function to get the duration value for sorting
  function getDurationValue(card) {
    const durationText = card.querySelector('.fa-clock').nextElementSibling.textContent;
    let minutes = 0;

    if (durationText.includes('Ø³Ø§Ø¹Ø©')) {
      const hours = parseInt(durationText.match(/Ø³Ø§Ø¹Ø© (\d+)/)[1] || 0);
      minutes += hours * 60;

      const minutesPart = durationText.match(/(\d+) Ø¯Ù‚ÙŠÙ‚Ø©/);
      if (minutesPart && minutesPart[1]) {
        minutes += parseInt(minutesPart[1]);
      }
    } else {
      minutes = parseInt(durationText.match(/(\d+) Ø¯Ù‚ÙŠÙ‚Ø©/)[1] || 0);
    }

    return minutes;
  }

  // Confirm delete
  document.querySelectorAll('.delete-service').forEach(button => {
    button.addEventListener('click', function(e) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©ØŸ')) {
        e.preventDefault();
      }
    });
  });
</script>

{% endblock %}